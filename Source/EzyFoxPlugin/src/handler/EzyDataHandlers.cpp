
#include "EzyDataHandlers.h"
#include "logger/EzyLogger.h"
#include "EzyClient.h"
#include "EzyDataHandler.h"

EZY_NAMESPACE_START_WITH(handler)
    
EzyDataHandlers::EzyDataHandlers(EzyClient* client) {
    this->mClient = client;
}

EzyDataHandlers::~EzyDataHandlers() {
    EZY_FOREACH_MAP(mHandlers)
        EZY_SAFE_DELETE(it->second);
    mHandlers.clear();
}
    
void EzyDataHandlers::handle(constant::EzyCommand cmd, entity::EzyArray *data) {
    auto handler = mHandlers[cmd];
    if(handler) {
        handler->handle(data);
    }
    else {
        auto cmdName = constant::getCommandName(cmd);
        logger::log("has no handler for command: %s", cmdName.c_str());
    }
}

EzyDataHandler* EzyDataHandlers::getHandler(constant::EzyCommand cmd) {
    auto handler = mHandlers[cmd];
    return handler;
}

void EzyDataHandlers::addHandler(constant::EzyCommand cmd, EzyDataHandler* handler) {
    handler->setClient(mClient);
    auto old = mHandlers[cmd];
    mHandlers[cmd] = handler;
    if(old) EZY_SAFE_DELETE(old);
}

EZY_NAMESPACE_END_WITH
